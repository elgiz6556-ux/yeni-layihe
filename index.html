<!DOCTYPE html>
<html lang="az">
<head>
    <style>
        /* ≈ûifr…ô sah…ôsi √º√ß√ºn …ôlav…ô stil */
        .pass-inp { width: 100%; background: #050810; border: 1px solid #334155; border-radius: 12px; padding: 12px; color: #fff; text-align: center; margin-top: 10px; }
        .lock-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1500; display: none; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="roomLock" class="lock-overlay">
    <h3 style="color:var(--accent)">üîí Bu otaq ≈üifr…ôlidir</h3>
    <input type="password" id="rPass" class="pass-inp" style="width:200px" placeholder="Otaq kodu...">
    <div style="margin-top:15px; display:flex; gap:10px;">
        <button onclick="checkRoomPass()" style="padding:10px 20px; background:var(--accent); border:none; border-radius:10px; color:#fff;">A√á</button>
        <button onclick="cancelRoom()" style="padding:10px 20px; background:#444; border:none; border-radius:10px; color:#fff;">GERƒ∞</button>
    </div>
</div>

<div id="authBox" class="auth" style="display:none;">
    <div class="card">
        <h2 style="color:var(--accent)">X-ELITE</h2>
        <input type="text" id="uN" class="pass-inp" placeholder="ƒ∞stifad…ô√ßi adƒ±...">
        <input type="password" id="uP" class="pass-inp" placeholder="≈ûifr…ôniz...">
        <p id="err" style="color:#f43f5e; font-size:10px; margin-top:10px;"></p>
        <button onclick="handleLogin()" style="width:100%; padding:14px; background:var(--accent); color:#fff; border:none; border-radius:12px; font-weight:900; margin-top:15px;">Gƒ∞Rƒ∞≈û / QEYDƒ∞YYAT</button>
    </div>
</div>

<script>
    // ... Supabase Client init eyni qalƒ±r ...

    // Otaq ≈üifr…ôl…ôri datasƒ±
    const ROOM_PASSWORDS = {
        'VIP': 'elite777', // VIP otaƒüƒ±nƒ±n ≈üifr…ôsi
        'Gaming': ''       // Bo≈üdursa ≈üifr…ô ist…ôm…ôy…ôc…ôk
    };

    let pendingRoom = '';

    async function handleLogin() {
        const n = document.getElementById('uN').value.trim().toLowerCase();
        const p = document.getElementById('uP').value.trim();
        if(!n || !p) return;

        // Bazadan bu adda istifad…ô√ßini yoxla
        const { data } = await sb.from('messages').select('nickname, content').eq('nickname', n).eq('group_id', 'SYS_AUTH').limit(1);

        if(data && data.length > 0) {
            // ƒ∞stifad…ô√ßi var, ≈üifr…ôni yoxla
            if(data[0].content === p) {
                saveAndGo(n);
            } else {
                document.getElementById('err').innerText = "S…ôhv ≈üifr…ô!";
            }
        } else {
            // Yeni istifad…ô√ßi yaradƒ±lƒ±r (ƒ∞lk d…ôf…ô girirs…ô ≈üifr…ôsi qeyd olunur)
            await sb.from('messages').insert([{ content: p, nickname: n, group_id: 'SYS_AUTH' }]);
            saveAndGo(n);
        }
    }

    function saveAndGo(n) {
        user = { n, a: `https://api.dicebear.com/7.x/bottts/svg?seed=${n}` };
        localStorage.setItem('x_final_v1', JSON.stringify(user));
        location.reload();
    }

    // Otaq d…ôyi≈üm…ô funksiyasƒ±nƒ± t…ôkmill…ô≈üdiririk
    function setRoom(r, el) {
        if(ROOM_PASSWORDS[r]) {
            pendingRoom = r;
            document.getElementById('roomLock').style.display = 'flex';
        } else {
            enterRoom(r);
        }
    }

    function checkRoomPass() {
        const pass = document.getElementById('rPass').value;
        if(pass === ROOM_PASSWORDS[pendingRoom]) {
            document.getElementById('roomLock').style.display = 'none';
            document.getElementById('rPass').value = '';
            enterRoom(pendingRoom);
        } else {
            alert("Otaq ≈üifr…ôsi s…ôhvdir!");
        }
    }

    function enterRoom(r) {
        room = r;
        document.getElementById('curRoom').innerText = r.toUpperCase();
        load();
        // UI-da aktiv otaƒüƒ± i≈üar…ôl…ô
        document.querySelectorAll('.r-btn').forEach(b => b.classList.remove('active'));
        // (Sidebar d√ºym…ôl…ôrin…ô id ver…ôr…ôk r…ôngini d…ôyi≈ü…ô bil…ôrs…ôn)
    }

    function cancelRoom() {
        document.getElementById('roomLock').style.display = 'none';
    }
</script>
</body>
</html>
 
